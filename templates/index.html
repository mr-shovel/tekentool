<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tekentool</title>
  <style>
    /* Ensure padding and borders are included in element's width/height */
    * {
      box-sizing: border-box;
    }
    body {
      display: flex;
      height: 100vh;
      margin: 0;
      font-family: sans-serif;
    }
    /* Sidebar with fixed width and text wrapping */
    #sidebar {
      width: 250px;
      padding: 20px;
      background: #f4f4f4;
      overflow-y: auto;
      word-wrap: break-word;
    }
    /* Main area takes the rest of the space, with padding to provide whitespace */
    /* Ensure padding and borders are included in the element's total width/height */
* {
  box-sizing: border-box;
}

#main {
  flex-grow: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px; /* whitespace around the container */
  background: #e0e0e0;
  overflow: auto;
}

#canvas-container {
  box-sizing: border-box;           /* Include padding in container dimensions */
  width: 90%;                       /* Use 90% of the available main area width */
  height: 90%;                      /* Use 90% of the available main area height */
  padding: 20px;                    /* Inner whitespace around the image */
  background: white;
  border-radius: 10px;
  box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;                 /* Hide any overflow */
}

#uploaded-image {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;              /* Ensure the image scales down while maintaining aspect ratio */
  display: block;
}

    /* Coordinates tooltip styling */
    #coords {
      position: absolute;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 5px;
      border-radius: 5px;
      display: none;
      pointer-events: none;
      font-size: 0.9em;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Upload Image</h2>
    <form action="/upload" method="post" enctype="multipart/form-data">
      <input type="file" name="file" accept="image/png, image/jpeg" required>
      <br /><br />
      <label for="paper-size">Paper Size:</label>
      <select id="paper-size">
        <option value="A4">A4</option>
        <option value="A5">A5</option>
      </select>
      <br /><br />
      <label for="orientation">Orientation:</label>
      <select id="orientation">
        <option value="portrait">Portrait</option>
        <option value="landscape">Landscape</option>
      </select>
      <br /><br />
      <button type="submit">Upload</button>
    </form>
  </div>

  <div id="main">
    {% if uploaded_image %}
      <div id="canvas-container">
        <img id="uploaded-image" src="{{ url_for('static', filename='uploads/' + uploaded_image) }}" alt="Uploaded Image">
        <div id="coords">X: 0mm, Y: 0mm</div>
      </div>
    {% endif %}
  </div>

  <script>
    const image = document.getElementById("uploaded-image");
    const orientation = document.getElementById("orientation");
    const coords = document.getElementById("coords");
    const paperSizes = { A4: [210, 297], A5: [148, 210] };

    if (image) {
      image.addEventListener("mousemove", (event) => {
        const rect = image.getBoundingClientRect();
        const pxX = event.clientX - rect.left;
        const pxY = event.clientY - rect.top;
        const size = paperSizes[document.getElementById("paper-size").value];
        
        let mmX, mmY;
        if (orientation.value === "landscape") {
            mmX = Math.round((pxX / rect.width) * size[1]);
            mmY = Math.round((pxY / rect.height) * size[0]);
        } else {
            mmX = Math.round((pxX / rect.width) * size[0]);
            mmY = Math.round((pxY / rect.height) * size[1]);
        }
        
        
        // console.log(orientation.value)
        coords.style.left = `${event.clientX + 10}px`;
        coords.style.top = `${event.clientY + 10}px`;
        coords.style.display = "block";
        coords.textContent = `X: ${mmX}mm, Y: ${mmY}mm`;
      });

      image.addEventListener("mouseleave", () => {
        coords.style.display = "none";
      });
    }
  </script>
</body>
</html>
